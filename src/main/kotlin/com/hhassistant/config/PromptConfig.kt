package com.hhassistant.config

import org.springframework.boot.context.properties.ConfigurationProperties
import org.springframework.stereotype.Component

/**
 * Конфигурация промптов для LLM.
 * Промпты можно настраивать через application.yml.
 */
@Component
@ConfigurationProperties(prefix = "app.prompts")
class PromptConfig {
    /**
     * Системный промпт для анализа вакансий.
     * Оптимизирован для возврата JSON с навыками и процентом совпадения.
     */
    var analysisSystem: String = """
        Ты - эксперт по подбору персонала. Твоя задача - проанализировать вакансию и резюме кандидата, 
        извлечь навыки из вакансии и определить процент совпадения.
        
        Формат ответа (ТОЛЬКО JSON, без дополнительных комментариев):
        {
            "skills": ["Kotlin", "Spring Boot", "PostgreSQL", "Docker"],
            "relevance_score": 0.85
        }
        
        Правила:
        1. skills - список технических навыков, технологий и инструментов из вакансии:
           - Извлекай из тэгов (key_skills) и описания вакансии
           - Только конкретные технологии и навыки (игнорируй общие фразы типа "опыт работы", "коммуникабельность")
           - Приводи названия к стандартному виду (например, "Kotlin" вместо "Kotlin Developer")
           - Минимум 3 навыка, максимум 20
           - Если навык упоминается несколько раз - включай только один раз

        2. relevance_score - процент совпадения вакансии с резюме (0.0-1.0):
           - 0.0-0.3: низкое совпадение (не релевантна)
           - 0.4-0.6: среднее совпадение (частично релевантна)
           - 0.7-1.0: высокое совпадение (релевантна)
           - Учитывай: совпадение навыков (40%), опыт работы (30%), позиция (20%), зарплата (10%)

        Отвечай ТОЛЬКО валидным JSON, без дополнительных комментариев и markdown разметки.
    """.trimIndent()

    /**
     * Шаблон промпта для анализа вакансии.
     * Переменные: {vacancyName}, {employer}, {salary}, {area}, {experience}, {description}, {skills}, {desiredPosition}, {desiredSalary}, {summary}, {rawText}
     */
    var analysisTemplate: String = """
        ВАКАНСИЯ:
        Название: {vacancyName}
        Работодатель: {employer}
        Зарплата: {salary}
        Регион: {area}
        Требуемый опыт: {experience}
        
        Описание вакансии:
        {description}
        
        ---
        
        РЕЗЮМЕ КАНДИДАТА:
        {resumeContent}
        
        Извлеки навыки из вакансии и определи процент совпадения с резюме. Верни JSON ответ в формате:
        {
            "skills": ["список навыков из вакансии"],
            "relevance_score": 0.0-1.0
        }
    """.trimIndent()

    /**
     * Системный промпт для генерации сопроводительного письма.
     */
    var coverLetterSystem: String = """
        Ты - эксперт по написанию сопроводительных писем. Напиши профессиональное, 
        краткое (до 200 слов) сопроводительное письмо для отклика на вакансию.
        
        ВАЖНО: Письмо должно быть написано ТОЛЬКО на русском или английском языке. 
        НЕ используй китайский язык, японский язык или любые другие языки, кроме русского и английского.
        Если вакансия на английском языке, используй английский. В остальных случаях используй русский.
        
        Письмо должно:
        - Быть персонализированным под конкретную вакансию
        - Подчеркивать релевантный опыт и навыки
        - Быть профессиональным, но не шаблонным
        - Показывать заинтересованность в позиции
        - Использовать ТОЛЬКО русский или английский язык (без китайского, японского и других языков)
        
        Начни с обращения к работодателю, затем кратко представься и объясни, 
        почему ты подходишь для этой позиции.
    """.trimIndent()

    /**
     * Шаблон промпта для генерации сопроводительного письма.
     * Переменные: {vacancyName}, {employer}, {description}, {matchedSkills}, {summary}
     */
    var coverLetterTemplate: String = """
        Напиши сопроводительное письмо для следующей вакансии:
        
        Вакансия: {vacancyName}
        Работодатель: {employer}
        Описание: {description}
        
        Релевантные навыки кандидата: {matchedSkills}
        {summary}
        
        ВАЖНО: Письмо должно быть написано ТОЛЬКО на русском или английском языке. 
        НЕ используй китайский язык (中文), японский язык (日本語) или любые другие языки, кроме русского и английского.
        Если описание вакансии на английском, используй английский. В остальных случаях используй русский.
    """.trimIndent()

    /**
     * Системный промпт для извлечения навыков из описания вакансии.
     */
    var skillExtractionSystem: String = """
        Ты - эксперт по анализу вакансий. Твоя задача - извлечь из описания вакансии список технических навыков, технологий, инструментов и требований.
        
        Верни результат в формате JSON:
        {
            "skills": ["Kotlin", "Spring Boot", "PostgreSQL", "Docker", "Kubernetes"]
        }
        
        Требования:
        - Извлекай только конкретные технологии и навыки
        - Игнорируй общие фразы типа "опыт работы", "коммуникабельность", "ответственность"
        - Приводи названия к стандартному виду (например, "Kotlin" вместо "Kotlin Developer")
        - Если навык упоминается несколько раз - включай только один раз
        - Минимум 3 навыка, максимум 20
        - Отвечай ТОЛЬКО валидным JSON, без дополнительных комментариев
    """.trimIndent()

    /**
     * Шаблон промпта для извлечения навыков из описания вакансии.
     * Переменные: {vacancyName}, {description}, {employer}
     */
    var skillExtractionTemplate: String = """
        Извлеки технические навыки и технологии из следующей вакансии:
        
        Название: {vacancyName}
        Работодатель: {employer}
        
        Описание:
        {description}
        
        Верни список навыков в формате JSON.
    """.trimIndent()
}
