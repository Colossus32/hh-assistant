spring:
  application:
    name: hh-assistant
  
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/hh_assistant}
    username: ${SPRING_DATASOURCE_USERNAME:hh_user}
    password: ${SPRING_DATASOURCE_PASSWORD:hh_pass}
    driver-class-name: org.postgresql.Driver
  
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.yaml
    enabled: true
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  jackson:
    serialization:
      write-dates-as-timestamps: false
    default-property-inclusion: non_null

app:
  schedule:
    vacancy-check: "0 */15 * * * *"  # Every 15 minutes
  max-vacancies-per-cycle: 50
  dry-run: true
  analysis:
    min-relevance-score: 0.6  # Minimum score to consider vacancy relevant
    max-concurrent-requests: 3  # Maximum concurrent requests to LLM for analysis
  prompts:
    # Системный промпт для анализа вакансий (можно переопределить)
    analysis-system: |
      Ты - эксперт по подбору персонала. Твоя задача - проанализировать вакансию и резюме кандидата, 
      определить релевантность вакансии для кандидата и предоставить структурированный ответ в формате JSON.
      
      Формат ответа:
      {
          "is_relevant": true/false,
          "relevance_score": 0.0-1.0,
          "reasoning": "Обоснование решения на русском языке",
          "matched_skills": ["навык1", "навык2", ...]
      }
      
      Критерии релевантности:
      - Совпадение ключевых навыков (вес: 40%)
      - Соответствие опыта работы требованиям (вес: 30%)
      - Соответствие желаемой позиции (вес: 20%)
      - Соответствие зарплатных ожиданий (вес: 10%)
      
      Отвечай ТОЛЬКО валидным JSON, без дополнительных комментариев.
    # Шаблон промпта для анализа (переменные: {vacancyName}, {employer}, {salary}, {area}, {experience}, {description}, {resumeContent})
    analysis-template: |
      ВАКАНСИЯ:
      Название: {vacancyName}
      Работодатель: {employer}
      Зарплата: {salary}
      Регион: {area}
      Требуемый опыт: {experience}
      
      Описание вакансии:
      {description}
      
      ---
      
      РЕЗЮМЕ КАНДИДАТА:
      {resumeContent}
      
      Проанализируй релевантность вакансии для кандидата и верни JSON ответ.
    # Системный промпт для генерации сопроводительного письма
    cover-letter-system: |
      Ты - эксперт по написанию сопроводительных писем. Напиши профессиональное, 
      краткое (до 200 слов) сопроводительное письмо на русском языке для отклика на вакансию.
      
      Письмо должно:
      - Быть персонализированным под конкретную вакансию
      - Подчеркивать релевантный опыт и навыки
      - Быть профессиональным, но не шаблонным
      - Показывать заинтересованность в позиции
      
      Начни с обращения к работодателю, затем кратко представься и объясни, 
      почему ты подходишь для этой позиции.
    # Шаблон промпта для генерации сопроводительного письма (переменные: {vacancyName}, {employer}, {description}, {matchedSkills}, {summary})
    cover-letter-template: |
      Напиши сопроводительное письмо для следующей вакансии:
      
      Вакансия: {vacancyName}
      Работодатель: {employer}
      Описание: {description}
      
      Релевантные навыки кандидата: {matchedSkills}
      {summary}

ollama:
  base-url: ${OLLAMA_BASE_URL:http://localhost:11434}  # For local Ollama (default)
  # For Docker: use http://host.docker.internal:11434
  model: ${OLLAMA_MODEL:qwen2.5:7b}
  temperature: 0.7
  timeout-seconds: 120
  max-in-memory-size-mb: 10

telegram:
  api:
    base-url: https://api.telegram.org
  bot-token: ${TELEGRAM_BOT_TOKEN:}
  chat-id: ${TELEGRAM_CHAT_ID:}
  enabled: ${TELEGRAM_ENABLED:true}
  content-type: application/json

hh:
  api:
    base-url: https://api.hh.ru
    access-token: ${HH_ACCESS_TOKEN:}
    user-agent: ${HH_USER_AGENT:HH-Assistant/1.0}
    accept-header: application/json
    auth-prefix: Bearer
    search:
      per-page: 50
      default-page: 0
  proxy:
    enabled: ${PROXY_ENABLED:false}
    host: ${PROXY_HOST:}
    port: ${PROXY_PORT:8080}
    type: ${PROXY_TYPE:HTTP}
    timeout-seconds: 30
  retry:
    max-attempts: 3
    initial-delay-seconds: 2
    max-backoff-seconds: 10
    rate-limit-status-code: 429
  rate-limit:
    requests-per-minute: 20  # Лимит запросов в минуту (HH.ru обычно позволяет 20-30)
    burst-capacity: 30  # Максимальное количество одновременных запросов
    wait-on-limit-seconds: 60  # Время ожидания при превышении лимита (в секундах)
  currency:
    default: RUR
  vacancy:
    area-not-specified: "Не указан"

logging:
  level:
    root: INFO
    com.hhassistant: DEBUG
    org.springframework.web: INFO
    org.hibernate: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/hh-assistant.log

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
      show-components: always
  health:
    indicators:
      enabled: true
    ollama:
      enabled: true
    hhapi:
      enabled: true
    telegram:
      enabled: true

