# Упрощенная диаграмма архитектуры

## Основной поток данных

```
┌─────────────────────────────────────────────────────────────────┐
│                    VacancySchedulerService                       │
│                      (@Scheduled cron)                           │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                   VacancyFetchService                           │
│  • Получает вакансии от HH.ru API                               │
│  • Сохраняет в БД                                                │
│  • Публикует: VacancyFetchedEvent                               │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                 VacancyContentValidator                          │
│  • Валидация по ключевым словам/фразам                           │
│  • Фильтрация ДО анализа через LLM                               │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                 VacancyAnalysisService                           │
│  • Анализирует релевантность через Ollama                       │
│  • Сохраняет анализ в БД                                         │
│  • Публикует: VacancyAnalyzedEvent                               │
│  • Добавляет в очередь генерации писем                           │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                CoverLetterQueueService                           │
│  • In-memory очередь генерации писем                             │
│  • Retry логика (до 3 попыток)                                   │
│  • Публикует: CoverLetterGeneratedEvent                          │
│  • Публикует: VacancyReadyForTelegramEvent                       │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│              VacancyNotificationService                          │
│  • Слушает: VacancyReadyForTelegramEvent                        │
│  • Формирует сообщение для Telegram                              │
│  • Отправляет в Telegram Bot API                                  │
│  • Обновляет статус через VacancyStatusService                   │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                 VacancyStatusService                             │
│  • Обновляет статус вакансии                                     │
│  • Публикует: VacancyStatusChangedEvent                          │
└─────────────────────────────────────────────────────────────────┘
```

## События (Spring Events)

```
┌──────────────────────┐
│  VacancyFetchedEvent  │  ← VacancyFetchService
└──────────────────────┘

┌──────────────────────┐
│ VacancyAnalyzedEvent │  ← VacancyAnalysisService
└──────────────────────┘

┌─────────────────────────────┐
│ CoverLetterGeneratedEvent    │  ← CoverLetterQueueService
└─────────────────────────────┘

┌──────────────────────────────┐
│ VacancyReadyForTelegramEvent  │  ← CoverLetterQueueService
│                               │  → VacancyNotificationService
└──────────────────────────────┘

┌─────────────────────────────┐
│ VacancyStatusChangedEvent    │  ← VacancyStatusService
└─────────────────────────────┘
```

## Внешние зависимости

```
┌──────────┐      ┌──────────┐      ┌──────────┐
│ HH.ru    │      │ Ollama   │      │ Telegram │
│   API    │      │   LLM    │      │ Bot API  │
└──────────┘      └──────────┘      └──────────┘
     │                 │                 │
     ▼                 ▼                 ▼
┌──────────┐      ┌──────────┐      ┌──────────┐
│HHVacancy │      │Ollama    │      │Telegram  │
│ Client   │      │Client    │      │Client    │
└──────────┘      └──────────┘      └──────────┘
```

## База данных

```
┌─────────────────────────────────────┐
│         PostgreSQL                  │
│                                     │
│  • vacancies                        │
│  • vacancy_analyses                 │
│  • search_configs                   │
│  • resumes                          │
└─────────────────────────────────────┘
```

## Мониторинг

```
┌─────────────────────────────────────┐
│         MetricsService              │
│  • Счетчики вакансий                │
│  • Счетчики событий                 │
│  • Таймеры операций                  │
│  • Gauges (размер очереди)          │
└───────────────────────────┬─────────┘
                            │
                            ▼
┌─────────────────────────────────────┐
│         Prometheus                  │
│  • Сбор метрик                      │
│  • Хранение временных рядов         │
└───────────────────────────┬─────────┘
                            │
                            ▼
┌─────────────────────────────────────┐
│         Grafana                      │
│  • Визуализация метрик              │
│  • Дашборды                          │
└─────────────────────────────────────┘
```



