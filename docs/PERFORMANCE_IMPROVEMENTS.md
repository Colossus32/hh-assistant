# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω–∞–ª–∏–∑ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ flow –ø–æ–ª—É—á–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024  
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch-–æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
- –í `VacancyFetchService.kt` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å `map { vacancyRepository.save(it) }` - —ç—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Hibernate batch –≤ `application.yml`
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ 100+ –≤–∞–∫–∞–Ω—Å–∏–π —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å 100+ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `saveAll()` —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ –±–∞—Ç—á–∏ –ø–æ 100 –≤–∞–∫–∞–Ω—Å–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Hibernate batch –≤ `application.yml`
- Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç INSERT-–∑–∞–ø—Ä–æ—Å—ã –≤ –±–∞—Ç—á–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
private fun saveVacanciesInBatches(vacancies: List<Vacancy>): List<Vacancy> {
    val batchSize = 100 // –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    
    if (vacancies.size <= batchSize) {
        // –ï—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–π –Ω–µ–º–Ω–æ–≥–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Å—Ä–∞–∑—É
        return vacancyRepository.saveAll(vacancies)
    }
    
    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞—Ç—á–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ —á–∞—Å—Ç—è–º
    return vacancies.chunked(batchSize).flatMap { batch ->
        vacancyRepository.saveAll(batch)
    }
}
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `application.yml`:**
```yaml
spring:
  jpa:
    properties:
      hibernate:
        jdbc:
          batch_size: 50  # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è Hibernate
        order_inserts: true
        order_updates: true
        jdbc:
          batch_versioned_data: true
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ 100 –≤–∞–∫–∞–Ω—Å–∏–π: –≤–º–µ—Å—Ç–æ 100 INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 2-3 batch-–∑–∞–ø—Ä–æ—Å–∞ (–ø–æ 50 –≤–∞–∫–∞–Ω—Å–∏–π –≤ –∫–∞–∂–¥–æ–º)
- **10-50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∞–∫–∞–Ω—Å–∏–π
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

### 2. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
- –ó–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –í–°–ï ID –≤–∞–∫–∞–Ω—Å–∏–π –≤ –ø–∞–º—è—Ç—å (`findAllIds()`) –ø—Ä–∏ –∫–∞–∂–¥–æ–º cache miss
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∞–∫–∞–Ω—Å–∏–π (2500+) —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ
- –ö—ç—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö ID

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –ö—ç—à —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç `Set<String>` –≤ –ø–∞–º—è—Ç–∏ (Caffeine)
- –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∏—Ö ID –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Set
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –∫—ç—à –ø—É—Å—Ç)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
private fun updateVacancyIdsCacheIncrementally(newVacancyIds: List<String>) {
    val cacheKey = "all"
    val existingIds = vacancyIdsCache.getIfPresent(cacheKey)
    
    if (existingIds != null) {
        // –ö—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ ID –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
        val updatedIds = existingIds.toMutableSet().apply {
            addAll(newVacancyIds)
        }
        vacancyIdsCache.put(cacheKey, updatedIds)
    } else {
        // –ö—ç—à –ø—É—Å—Ç - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ ID –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
        val allIds = vacancyRepository.findAllIds().toSet()
        vacancyIdsCache.put(cacheKey, allIds)
    }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** 
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (O(n) –≥–¥–µ n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π)
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ `Set.contains()` - O(1)

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è batch-–æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –±–µ–∑ —è–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```kotlin
@Transactional
suspend fun saveVacancies(vacancies: List<Vacancy>) {
    vacancyRepository.saveAll(vacancies)
}
```

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
–°–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
```kotlin
val filteredDtos = vacancyDtos.filter { ... }  // –§–∏–ª—å—Ç—Ä –ø–æ –æ–ø—ã—Ç—É ‚Üí –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
val validatedDtos = filteredDtos.filter { ... }  // –§–∏–ª—å—Ç—Ä –ø–æ keywords ‚Üí –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
val newVacancies = validatedDtos.map { ... }.filter { ... }.map { ... }  // –ï—â–µ 3 –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
```
–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ 100 –≤–∞–∫–∞–Ω—Å–∏–π —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å 4+ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ —á–µ—Ä–µ–∑ `asSequence()`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–µ–Ω–∏–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—á–µ—Ç—á–∏–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
val newVacancies = vacancyDtos
    .asSequence()
    .mapNotNull { vacancyDto ->
        // –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ö–æ–¥–µ
        if (isMoreThan6Years) {
            excludedByExperience++
            return@mapNotNull null
        }
        if (containsExclusionKeyword) {
            excludedByKeywords++
            return@mapNotNull null
        }
        vacancyDto
    }
    .map { it.toEntity(formattingConfig) }
    .filter { it.id !in existingVacancyIds }
    .map { it.copy(status = VacancyStatus.QUEUED) }
    .toList() // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ List —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ 100 –≤–∞–∫–∞–Ω—Å–∏–π: –≤–º–µ—Å—Ç–æ 4+ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π ‚Üí 0 –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
- **–°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 60-80%** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞ —Å—á–µ—Ç –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –≤–º–µ—Å—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö

---

### 5. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª—Å—è –≤–µ—Å—å –∫—ç—à ID, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö ID –∏–∑ –ë–î.

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —á–µ—Ä–µ–∑ Caffeine
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∏—Ö ID –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Set –≤ –∫—ç—à–µ
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –∫—ç—à –ø—É—Å—Ç)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
private fun updateVacancyIdsCacheIncrementally(newVacancyIds: List<String>) {
    val cacheKey = "all"
    val existingIds = vacancyIdsCache.getIfPresent(cacheKey)
    
    if (existingIds != null) {
        // –ö—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ ID –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
        val updatedIds = existingIds.toMutableSet().apply {
            addAll(newVacancyIds)
        }
        vacancyIdsCache.put(cacheKey, updatedIds)
    } else {
        // –ö—ç—à –ø—É—Å—Ç - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ ID –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
        val allIds = vacancyRepository.findAllIds().toSet()
        vacancyIdsCache.put(cacheKey, allIds)
    }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (O(n) –≥–¥–µ n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π)
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–∞–∫–∞–Ω—Å–∏–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
–í `VacancyService.kt` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ (–º–µ—Ç–æ–¥—ã `updateVacancyStatus`, `updateVacancyStatusById`) –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ `vacancyIdsCache` —á–µ—Ä–µ–∑ `@CacheEvict`, —Ö–æ—Ç—è ID –≤–∞–∫–∞–Ω—Å–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è. –≠—Ç–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º, –Ω–æ –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–∂–µ, —á–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π.

---

### 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ –ø–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
–í `SkillExtractionService.kt:114` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `save()` –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏ –≤–∞–∫–∞–Ω—Å–∏—è-–Ω–∞–≤—ã–∫ –≤ —Ü–∏–∫–ª–µ `forEach`, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤. –¢–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å N –∑–∞–ø—Ä–æ—Å–æ–≤ `existsByVacancyIdAndSkillId` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–µ–π.

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è: –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å `findByVacancyId()` –≤–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤ `existsByVacancyIdAndSkillId`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ batch-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `saveAll()` - –≤—Å–µ –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–≤—è–∑–µ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–≤—è–∑–µ–π
val existingLinks = vacancySkillRepository.findByVacancyId(vacancy.id)
val existingSkillIds = existingLinks.map { it.skillId }.toSet()

// –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏ (–∫–æ—Ç–æ—Ä—ã—Ö –µ—â–µ –Ω–µ—Ç)
val newVacancySkills = savedSkills
    .mapNotNull { skill ->
        val skillId = skill.id ?: return@mapNotNull null
        if (skillId !in existingSkillIds) {
            VacancySkill(
                vacancyId = vacancy.id,
                skillId = skillId,
                extractedAt = extractedAt,
            )
        } else {
            null
        }
    }

// Batch-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Å–≤—è–∑–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
if (newVacancySkills.isNotEmpty()) {
    vacancySkillRepository.saveAll(newVacancySkills)
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ 10 –Ω–∞–≤—ã–∫–æ–≤: –≤–º–µ—Å—Ç–æ 10+ INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 1 batch INSERT-–∑–∞–ø—Ä–æ—Å
- –í–º–µ—Å—Ç–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ `existsByVacancyIdAndSkillId` ‚Üí 1 –∑–∞–ø—Ä–æ—Å `findByVacancyId`
- **5-10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–≤—è–∑–µ–π –≤–∞–∫–∞–Ω—Å–∏—è-–Ω–∞–≤—ã–∫
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞–∫–∞–Ω—Å–∏–π —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–∞–≤—ã–∫–æ–≤

---

## üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 7. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 100ms –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –¥–∞–∂–µ –∫–æ–≥–¥–∞ rate limit –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ.

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ RateLimitService
- –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è rate limit:
  - –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ (0) ‚Üí 500ms (–∂–¥–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)
  - –ú–∞–ª–æ —Ç–æ–∫–µ–Ω–æ–≤ (1-2) ‚Üí 100ms (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)
  - –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤ (3+) ‚Üí 10ms (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
/**
 * –í—ã—á–∏—Å–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ rate limit.
 */
private fun calculateAdaptiveDelay(): Long {
    val availableTokens = rateLimitService.getAvailableTokens()
    
    return when {
        availableTokens == 0L -> 500  // –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ - –∂–¥–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        availableTokens <= 2 -> 100   // –ú–∞–ª–æ —Ç–æ–∫–µ–Ω–æ–≤ - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        else -> 10                     // –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤ - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ü–∏–∫–ª–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:
if (hasMorePages) {
    val adaptiveDelay = calculateAdaptiveDelay()
    if (adaptiveDelay > 0) {
        delay(adaptiveDelay)
    }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤: –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Å 100ms –¥–æ 10ms ‚Üí **10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ**
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤: –∑–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 500ms ‚Üí –∑–∞—â–∏—Ç–∞ –æ—Ç rate limit
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏** –±–µ–∑ —Ä–∏—Å–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ç–µ–∫—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é rate limit

---

### 8. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ‚úÖ –ß–ê–°–¢–ò–ß–ù–û –†–ï–®–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
–î–ª—è –∫–∞–∂–¥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Set, –Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –¥–æ—Ä–æ–≥–∞—è –ø—Ä–∏ cache miss.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à Caffeine –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö ID –≤ –ø–∞–º—è—Ç–∏
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ `Set.contains()` - O(1)
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (cache miss)

**–ê–Ω–∞–ª–∏–∑:**
- –ü—Ä–∏ –Ω–µ–±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π (–∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è) —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –ø—Ä–∏ cache miss –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —á—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ
- –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∫—ç—à –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤ –ø–∞–º—è—Ç–∏
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (batch EXISTS –∑–∞–ø—Ä–æ—Å—ã) –±—ã–ª–∏ –±—ã –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –ø—Ä–∏ –º–∞–ª–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π

**–í—ã–≤–æ–¥:**
–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π. –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π –æ–±—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç

- **–°–∫–æ—Ä–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:** 10-50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–∏ batch-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- **–ü–∞–º—è—Ç—å:** –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 10-100 —Ä–∞–∑

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –Ω–∞—á–∏–Ω–∞—è —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

