# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω–∞–ª–∏–∑ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ flow –ø–æ–ª—É—á–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024  
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch-–æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
- –í `VacancyFetchService.kt` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å `map { vacancyRepository.save(it) }` - —ç—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Hibernate batch –≤ `application.yml`
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ 100+ –≤–∞–∫–∞–Ω—Å–∏–π —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å 100+ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `saveAll()` —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ –±–∞—Ç—á–∏ –ø–æ 100 –≤–∞–∫–∞–Ω—Å–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Hibernate batch –≤ `application.yml`
- Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç INSERT-–∑–∞–ø—Ä–æ—Å—ã –≤ –±–∞—Ç—á–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
private fun saveVacanciesInBatches(vacancies: List<Vacancy>): List<Vacancy> {
    val batchSize = 100 // –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    
    if (vacancies.size <= batchSize) {
        // –ï—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–π –Ω–µ–º–Ω–æ–≥–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Å—Ä–∞–∑—É
        return vacancyRepository.saveAll(vacancies)
    }
    
    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞—Ç—á–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ —á–∞—Å—Ç—è–º
    return vacancies.chunked(batchSize).flatMap { batch ->
        vacancyRepository.saveAll(batch)
    }
}
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `application.yml`:**
```yaml
spring:
  jpa:
    properties:
      hibernate:
        jdbc:
          batch_size: 50  # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è Hibernate
        order_inserts: true
        order_updates: true
        jdbc:
          batch_versioned_data: true
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ 100 –≤–∞–∫–∞–Ω—Å–∏–π: –≤–º–µ—Å—Ç–æ 100 INSERT-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 2-3 batch-–∑–∞–ø—Ä–æ—Å–∞ (–ø–æ 50 –≤–∞–∫–∞–Ω—Å–∏–π –≤ –∫–∞–∂–¥–æ–º)
- **10-50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è** –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∞–∫–∞–Ω—Å–∏–π
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

### 2. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–æ):**
- –ó–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –í–°–ï ID –≤–∞–∫–∞–Ω—Å–∏–π –≤ –ø–∞–º—è—Ç—å (`findAllIds()`) –ø—Ä–∏ –∫–∞–∂–¥–æ–º cache miss
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∞–∫–∞–Ω—Å–∏–π (2500+) —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ
- –ö—ç—à –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö ID

**–†–µ—à–µ–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):**
- –ö—ç—à —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç `Set<String>` –≤ –ø–∞–º—è—Ç–∏ (Caffeine)
- –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∏—Ö ID –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Set
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –∫—ç—à –ø—É—Å—Ç)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:**
```kotlin
private fun updateVacancyIdsCacheIncrementally(newVacancyIds: List<String>) {
    val cacheKey = "all"
    val existingIds = vacancyIdsCache.getIfPresent(cacheKey)
    
    if (existingIds != null) {
        // –ö—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ ID –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
        val updatedIds = existingIds.toMutableSet().apply {
            addAll(newVacancyIds)
        }
        vacancyIdsCache.put(cacheKey, updatedIds)
    } else {
        // –ö—ç—à –ø—É—Å—Ç - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ ID –∏–∑ –ë–î (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
        val allIds = vacancyRepository.findAllIds().toSet()
        vacancyIdsCache.put(cacheKey, allIds)
    }
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** 
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (O(n) –≥–¥–µ n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π)
- –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ `Set.contains()` - O(1)

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è batch-–æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –±–µ–∑ —è–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```kotlin
@Transactional
suspend fun saveVacancies(vacancies: List<Vacancy>) {
    vacancyRepository.saveAll(vacancies)
}
```

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
```kotlin
val filteredDtos = vacancyDtos.filter { ... }  // –§–∏–ª—å—Ç—Ä –ø–æ –æ–ø—ã—Ç—É
val validatedDtos = filteredDtos.filter { ... }  // –§–∏–ª—å—Ç—Ä –ø–æ keywords
val newVacancies = validatedDtos.map { ... }
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asSequence()` –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

### 5. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –≤–µ—Å—å –∫—ç—à ID, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö ID.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ (–¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ ID)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —É–º–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤ –ø–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í `SkillExtractionService.kt:114` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `save()` –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∏ –≤–∞–∫–∞–Ω—Å–∏—è-–Ω–∞–≤—ã–∫.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- Batch-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `saveAll()`

---

## üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 7. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 100ms –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ rate limit
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (—Å —É—á–µ—Ç–æ–º –ª–∏–º–∏—Ç–æ–≤ API)

---

### 8. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
–î–ª—è –∫–∞–∂–¥–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Set, –Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö ID –¥–æ—Ä–æ–≥–∞—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findAllById()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö ID
- –ò–ª–∏ `EXISTS` –∑–∞–ø—Ä–æ—Å—ã

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π –æ–±—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç

- **–°–∫–æ—Ä–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:** 10-50x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–∏ batch-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- **–ü–∞–º—è—Ç—å:** –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 10-100 —Ä–∞–∑

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –Ω–∞—á–∏–Ω–∞—è —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

