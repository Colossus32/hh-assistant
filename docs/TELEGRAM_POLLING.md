# Telegram Bot Polling

## ะะฑะทะพั

ะะตะฐะปะธะทะพะฒะฐะฝ ะผะตัะฐะฝะธะทะผ polling ะดะปั Telegram ะฑะพัะฐ, ะบะพัะพััะน ะฟะพะทะฒะพะปัะตั ะฟะพะปััะฐัั ะบะพะผะฐะฝะดั ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฑะตะท ะฝะตะพะฑัะพะดะธะผะพััะธ ะฝะฐัััะพะนะบะธ webhook. ะะพั ะฟะตัะธะพะดะธัะตัะบะธ ะพะฟัะฐัะธะฒะฐะตั Telegram API ัะตัะตะท ะผะตัะพะด `getUpdates` ะธ ะพะฑัะฐะฑะฐััะฒะฐะตั ะบะพะผะฐะฝะดั, ะฒัะทัะฒะฐั ัะพะพัะฒะตัััะฒัััะธะต REST API endpoints ะฟัะธะปะพะถะตะฝะธั.

## ะัะตะธะผััะตััะฒะฐ ะฟะพะดัะพะดะฐ

1. **ะะต ััะตะฑัะตั ะฟัะฑะปะธัะฝะพะณะพ URL** - ัะฐะฑะพัะฐะตั ะทะฐ NAT/firewall
2. **ะัะพัะต ะฒ ะฝะฐัััะพะนะบะต** - ะฝะต ะฝัะถะฝะพ ะฝะฐัััะฐะธะฒะฐัั SSL ัะตััะธัะธะบะฐัั ะธ ะฟัะฑะปะธัะฝัะน ะดะพะผะตะฝ
3. **ะะฝัะตะณัะฐัะธั ั REST API** - ะบะพะผะฐะฝะดั ะพะฑัะฐะฑะฐััะฒะฐัััั ัะตัะตะท ัััะตััะฒัััะธะต REST endpoints
4. **ะะฒัะพะผะฐัะธัะตัะบะฐั ะพะฑัะฐะฑะพัะบะฐ** - polling ัะฐะฑะพัะฐะตั ะฒ ัะพะฝะต, ะฝะต ััะตะฑัะตั ัััะฝะพะณะพ ะฒะผะตัะฐัะตะปัััะฒะฐ

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ  Telegram API   โ
โ  (getUpdates)   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ Polling (ะบะฐะถะดัะต 5 ัะตะบัะฝะด)
         โ
โโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  TelegramPollingService              โ
โ  - ะะตัะธะพะดะธัะตัะบะธ ะฒัะทัะฒะฐะตั getUpdates  โ
โ  - ะะฑัะฐะฑะฐััะฒะฐะตั ะฟะพะปััะตะฝะฝัะต ะพะฑะฝะพะฒะปะตะฝะธัโ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ ะะตัะตะดะฐะตั ะบะพะผะฐะฝะดั
         โ
โโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  TelegramCommandHandler              โ
โ  - ะะฐััะธั ะบะพะผะฐะฝะดั                     โ
โ  - ะัะทัะฒะฐะตั REST API endpoints       โ
โ  - ะคะพัะผะธััะตั ะพัะฒะตัั ะฟะพะปัะทะพะฒะฐัะตะปั     โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ HTTP ะทะฐะฟัะพัั
         โ
โโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  REST API Controllers                 โ
โ  - /api/vacancies/unviewed            โ
โ  - /api/vacancies/{id}/mark-applied   โ
โ  - /api/vacancies/{id}/mark-not-      โ
โ    interested                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะะพะผะฟะพะฝะตะฝัั

### 1. TelegramClient.getUpdates()

ะะตัะพะด ะดะปั ะฟะพะปััะตะฝะธั ะพะฑะฝะพะฒะปะตะฝะธะน ะพั Telegram Bot API:

```kotlin
suspend fun getUpdates(
    offset: Long? = null,  // ID ะฟะพัะปะตะดะฝะตะณะพ ะพะฑัะฐะฑะพัะฐะฝะฝะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั
    limit: Int = 100,      // ะะฐะบัะธะผัะผ ะพะฑะฝะพะฒะปะตะฝะธะน ะทะฐ ะทะฐะฟัะพั
    timeout: Int = 0,      // ะขะฐะนะผะฐัั ะดะปั long polling (0-60 ัะตะบัะฝะด)
): List<Update>
```

### 2. TelegramPollingService

ะกะตัะฒะธั, ะบะพัะพััะน ะฟะตัะธะพะดะธัะตัะบะธ ะพะฟัะฐัะธะฒะฐะตั Telegram API:

- ะัะฟะพะปัะทัะตั `@Scheduled` ะดะปั ะฟะตัะธะพะดะธัะตัะบะพะณะพ ะฒัะทะพะฒะฐ
- ะะพะดะดะตัะถะธะฒะฐะตั long polling ะดะปั ัะผะตะฝััะตะฝะธั ะบะพะปะธัะตััะฒะฐ ะทะฐะฟัะพัะพะฒ
- ะะฑัะฐะฑะฐััะฒะฐะตั rate limits ะฐะฒัะพะผะฐัะธัะตัะบะธ
- ะััะปะตะถะธะฒะฐะตั `lastUpdateId` ะดะปั ะฟัะพะฟััะบะฐ ัะถะต ะพะฑัะฐะฑะพัะฐะฝะฝัั ะพะฑะฝะพะฒะปะตะฝะธะน

**ะะพะฝัะธะณััะฐัะธั:**
```yaml
telegram:
  polling:
    enabled: true              # ะะบะปััะธัั/ะฒัะบะปััะธัั polling
    interval-seconds: 5       # ะะฝัะตัะฒะฐะป ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ
    timeout-seconds: 30       # ะขะฐะนะผะฐัั ะดะปั long polling
```

### 3. TelegramCommandHandler

ะะฑัะฐะฑะพััะธะบ ะบะพะผะฐะฝะด, ะบะพัะพััะน:

- ะะฐััะธั ะบะพะผะฐะฝะดั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะัะทัะฒะฐะตั ัะพะพัะฒะตัััะฒัััะธะต REST API endpoints
- ะคะพัะผะธััะตั ะพัะฒะตัั ะฒ ัะพัะผะฐัะต HTML ะดะปั Telegram

**ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะบะพะผะฐะฝะดั:**

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต | REST API Endpoint |
|---------|----------|-------------------|
| `/start` | ะัะธะฒะตัััะฒะธะต ะธ ัะฟะธัะพะบ ะบะพะผะฐะฝะด | - |
| `/help` | ะกะฟัะฐะฒะบะฐ ะฟะพ ะบะพะผะฐะฝะดะฐะผ | - |
| `/status` | ะกัะฐััั ัะธััะตะผั | - |
| `/vacancies` | ะกะฟะธัะพะบ ะฝะตะฟัะพัะผะพััะตะฝะฝัั ะฒะฐะบะฐะฝัะธะน | `GET /api/vacancies/unviewed` |
| `/mark-applied-{id}` | ะัะผะตัะธัั ะฒะฐะบะฐะฝัะธั ะบะฐะบ "ะพัะบะปะธะบะฝัะปัั" | `POST /api/vacancies/{id}/mark-applied` |
| `/mark-not-interested-{id}` | ะัะผะตัะธัั ะฒะฐะบะฐะฝัะธั ะบะฐะบ "ะฝะตะธะฝัะตัะตัะฝะฐั" | `POST /api/vacancies/{id}/mark-not-interested` |

## ะะฐัััะพะนะบะฐ

### 1. ะะบะปััะธัั polling

ะ `application.yml`:
```yaml
telegram:
  polling:
    enabled: true
    interval-seconds: 5
    timeout-seconds: 30
```

ะะปะธ ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:
```bash
TELEGRAM_POLLING_ENABLED=true
TELEGRAM_POLLING_INTERVAL=5
TELEGRAM_POLLING_TIMEOUT=30
```

### 2. ะะฐัััะพะธัั ะฑะฐะทะพะฒัะน URL API

ะ `application.yml`:
```yaml
app:
  api:
    base-url: http://localhost:8080  # URL ะฒะฐัะตะณะพ ะฟัะธะปะพะถะตะฝะธั
```

### 3. ะฃะฑะตะดะธัััั, ััะพ ะฑะพั ัะพะบะตะฝ ะฝะฐัััะพะตะฝ

```bash
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

ะะพัะปะต ะทะฐะฟััะบะฐ ะฟัะธะปะพะถะตะฝะธั polling ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐัะฝะตั ัะฐะฑะพัะฐัั. ะะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะพัะฟัะฐะฒะปััั ะบะพะผะฐะฝะดั ะฑะพัั:

```
/start
/vacancies
/mark-applied-12345678
/mark-not-interested-12345678
/help
```

## ะัะธะผะตัั ะพัะฒะตัะพะฒ

### ะะพะผะฐะฝะดะฐ /vacancies

```
๐ ะะตะฟัะพัะผะพััะตะฝะฝัะต ะฒะฐะบะฐะฝัะธะธ (5):

1. Java Developer
   ๐ผ ะะะ "ะะพะผะฟะฐะฝะธั"
   ๐ฐ 200000 - 300000 RUR
   ๐ ะัะบัััั ะฝะฐ HH.ru
   โ /mark-applied-12345678 | โ /mark-not-interested-12345678

2. Kotlin Developer
   ...
```

### ะะพะผะฐะฝะดะฐ /mark-applied-12345678

```
โ ะะฐะบะฐะฝัะธั ะพัะผะตัะตะฝะฐ ะบะฐะบ "ะพัะบะปะธะบะฝัะปัั"
```

## ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

- **Rate Limit**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟะฐัะทะฐ ะฝะฐ 60 ัะตะบัะฝะด ะฟัะธ ะฟัะตะฒััะตะฝะธะธ ะปะธะผะธัะฐ
- **ะัะธะฑะบะธ API**: ะะพะณะธัััััั ะธ ะฝะต ะฟัะตััะฒะฐัั ัะฐะฑะพัั polling
- **ะะตะธะทะฒะตััะฝัะต ะบะพะผะฐะฝะดั**: ะัะฟัะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต ั ะฟะพะดัะบะฐะทะบะพะน ะธัะฟะพะปัะทะพะฒะฐัั `/help`

## ะัะบะปััะตะฝะธะต polling

ะัะปะธ ะฝัะถะฝะพ ะพัะบะปััะธัั polling (ะฝะฐะฟัะธะผะตั, ะฟัะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะธ webhook):

```yaml
telegram:
  polling:
    enabled: false
```

## ะกัะฐะฒะฝะตะฝะธะต ั Webhook

| ะะฐัะฐะผะตัั | Polling | Webhook |
|----------|---------|---------|
| ะขัะตะฑัะตั ะฟัะฑะปะธัะฝัะน URL | โ ะะตั | โ ะะฐ |
| ะขัะตะฑัะตั SSL ัะตััะธัะธะบะฐั | โ ะะตั | โ ะะฐ |
| ะัะพััะพัะฐ ะฝะฐัััะพะนะบะธ | โ ะัะพััะพ | โ ะกะปะพะถะฝะตะต |
| ะะฐะดะตัะถะบะฐ ะฟะพะปััะตะฝะธั | โ๏ธ ะะพ 5 ัะตะบัะฝะด | โ ะะณะฝะพะฒะตะฝะฝะพ |
| ะะฐะฑะพัะฐ ะทะฐ NAT | โ ะะฐ | โ ะะตั |
| ะะฐัััะฐะฑะธััะตะผะพััั | โ๏ธ ะะณัะฐะฝะธัะตะฝะฐ | โ ะัััะต |

## ะะฐะปัะฝะตะนัะธะต ัะปัััะตะฝะธั

1. **ะะพะดะดะตัะถะบะฐ ะฝะตัะบะพะปัะบะธั ัะฐัะพะฒ** - ัะตะนัะฐั ะธัะฟะพะปัะทัะตััั chatId ะธะท ะบะพะฝัะธะณััะฐัะธะธ
2. **Inline ะบะฝะพะฟะบะธ** - ะดะพะฑะฐะฒะธัั ะบะฝะพะฟะบะธ ะดะปั ะฑัััััั ะดะตะนััะฒะธะน
3. **ะะฑัะฐะฑะพัะบะฐ ะดะพะบัะผะตะฝัะพะฒ** - ะทะฐะณััะทะบะฐ ัะตะทัะผะต ัะตัะตะท ะฑะพัะฐ
4. **ะะฝะพะณะพัะทััะฝะพััั** - ะฟะพะดะดะตัะถะบะฐ ัะฐะทะฝัั ัะทัะบะพะฒ
5. **ะััะธัะพะฒะฐะฝะธะต** - ะบััะธัะพะฒะฐะฝะธะต ะพัะฒะตัะพะฒ API ะดะปั ัะผะตะฝััะตะฝะธั ะฝะฐะณััะทะบะธ
